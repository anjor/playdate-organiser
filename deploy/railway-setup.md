# Railway Deployment Guide

## Setup Steps

### 1. Prepare Your Repository

First, let's create Railway-specific configuration files:

### 2. Backend Configuration for Railway

Railway needs a few adjustments to work properly with our setup.

#### Create `railway.json` in the root:
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "backend/Dockerfile"
  },
  "deploy": {
    "numReplicas": 1,
    "sleepApplication": false,
    "restartPolicyType": "ON_FAILURE"
  }
}
```

#### Update backend Dockerfile for Railway:
```dockerfile
# Use the existing Dockerfile but add Railway-specific optimizations
FROM python:3.11-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Install uv
RUN pip install uv

# Install dependencies
RUN uv pip install --system fastapi uvicorn[standard] sqlalchemy alembic psycopg2-binary python-jose[cryptography] passlib[bcrypt] python-multipart python-dotenv pydantic pydantic-settings email-validator

# Copy application files
COPY app ./app
COPY alembic ./alembic
COPY alembic.ini ./
COPY start.sh ./

# Make start script executable
RUN chmod +x start.sh

# Railway provides PORT environment variable
EXPOSE $PORT

CMD ["sh", "-c", "uvicorn app.main:app --host 0.0.0.0 --port $PORT"]
```

### 3. Frontend Configuration for Vercel

Since Railway's free tier is limited, deploy frontend to Vercel (free):

#### Create `vercel.json` in frontend directory:
```json
{
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/next"
    }
  ],
  "env": {
    "NEXT_PUBLIC_API_URL": "@api_url"
  }
}
```

## Deployment Process

### Step 1: Deploy Backend to Railway

1. **Sign up at railway.app**
2. **Connect your GitHub repository**
3. **Create new project → Deploy from GitHub**
4. **Select your repository**
5. **Choose root directory and set these environment variables:**

```bash
# Railway Environment Variables
DATABASE_URL=postgresql://postgres:password@railway.app:5432/railway
SECRET_KEY=your-super-secret-key-generate-a-long-random-one
BACKEND_CORS_ORIGINS=["https://your-frontend.vercel.app"]
PORT=8000
```

6. **Add PostgreSQL database:**
   - In Railway dashboard: Add service → Database → PostgreSQL
   - Railway will automatically set DATABASE_URL

### Step 2: Deploy Frontend to Vercel

1. **Install Vercel CLI:**
```bash
npm install -g vercel
```

2. **Deploy frontend:**
```bash
cd frontend
vercel

# Follow prompts:
# Set up and deploy? Yes
# Which scope? Your personal account
# Link to existing project? No
# Project name: playdate-organiser-frontend
# Directory: ./frontend
# Override settings? No
```

3. **Set environment variable in Vercel:**
   - Go to Vercel dashboard
   - Select your project → Settings → Environment Variables
   - Add: `NEXT_PUBLIC_API_URL` = `https://your-railway-backend-url.railway.app`

### Step 3: Update CORS Settings

Once you have both URLs, update Railway backend environment:
```bash
BACKEND_CORS_ORIGINS=["https://your-frontend.vercel.app", "https://your-railway-backend.railway.app"]
```

## Alternative: All-in-One Railway (Simpler)

If you want everything on Railway:

### Create separate services:
1. **PostgreSQL Database** (Railway service)
2. **Backend API** (Railway service from /backend)
3. **Frontend** (Railway service from /frontend)

### Environment Variables:
```bash
# Backend service
DATABASE_URL=(auto-generated by Railway)
SECRET_KEY=your-secret-key
BACKEND_CORS_ORIGINS=["https://frontend-service.railway.app"]

# Frontend service  
NEXT_PUBLIC_API_URL=https://backend-service.railway.app
```

## Cost Estimation

### Option 1: Railway + Vercel
- **Railway**: Free $5/month credit (backend + database)
- **Vercel**: Free tier (frontend)
- **Total**: Free for development

### Option 2: All Railway
- **Railway**: ~$5-10/month (all services)
- **Benefits**: Single platform, easier management

## Custom Domain (Optional)

### Railway:
1. Go to project settings
2. Add custom domain
3. Update DNS records

### Vercel:
1. Project settings → Domains
2. Add custom domain
3. Update DNS records

## Monitoring

Both platforms provide:
- ✅ Automatic deployments from GitHub
- ✅ Logs and monitoring
- ✅ Environment variable management
- ✅ SSL certificates
- ✅ Easy rollbacks